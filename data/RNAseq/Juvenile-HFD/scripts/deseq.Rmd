---
title: "DESeq Analysis"
author: "Dave Bridges"
date: "August 2, 2015"
output: html_document
---


```{r global_options, include=FALSE}
library(knitr)
opts_chunk$set(fig.path='figures/',
               echo=FALSE, warning=FALSE, message=FALSE,dev=c('png','pdf'))
options(digits=3, scipen=8)
```

This script performs the DESeq analyses on the Juvenile HFD studies.  This script was most recently run on `r date()`

```{r data-entry}
input_folder <- '../server-scripts/htseq-output'
sample_table_file <- '../sample-mapping.csv'
sample_table <- read.csv(sample_table_file)
sample_table$Barcode <- paste(sample_table$Barcode, "counts.txt", sep="-")
```

The counts data, derived from HTSeq are located in `r input_folder`.  The sample mapping file is located in `r sample_table_file`.

```{r deseq}
library(DESeq2)
#for sampleTable each row describes one sample. The first column is the sample name, the second column the file name of the count file generated by htseq-count, and the remaining columns are sample metadata which will be stored in colData
dds.overall <- DESeqDataSetFromHTSeqCount(sampleTable = sample_table[1:33,],
                                       directory = input_folder, 
                                       design= ~ Tissue * Feeding * Diet)
library(BiocParallel)
register(MulticoreParam(4))
dds.overall <- DESeq(dds.overall, parallel=T, betaPrior = F)
res.overall <- results(dds.overall, parallel=T)
#summary(res.overall)
```

# Overall Analysis

The first model was a completely interacting model in which tissue, feeding state and diet were all able to interact.

```{r deseq-MA-plot-overall, fig.cap="MA Plot for Overall Model"}
plotMA(res.overall, main="DESeq2", ylim=c(-4,4))
```

```{r deseq-PCA-plot-overall, fig.cap="PCA Plot for Overall Model"}
rld.overall <- rlog(dds.overall)
plotPCA(rld.overall, intgroup=c("Tissue", "Feeding"))
distsRL <- dist(t(assay(rld.overall)))
```

```{r deseq-similarity-matrix, fig.cap="Similarity Matrix for All Samples"}
library(gplots)
mat <- as.matrix(distsRL)
rownames(mat) <- colnames(mat) <- rownames(colData(dds.overall))
hc <- hclust(distsRL)
heatmap.2(mat, Rowv=as.dendrogram(hc),
symm=TRUE, trace="none")
```

# Adipose Tissue

The adipose tissue samples are all eWAT samples

## Effects of Feeding State

This model used only the adipose tissue data, and tested for changes related to the feeding state.

```{r wat-diet}
dds.wat <- DESeqDataSetFromHTSeqCount(sampleTable = subset(sample_table, Tissue=="eWAT"),
                                       directory = input_folder, 
                                       design= ~ Feeding)

dds.wat <- DESeq(dds.wat, parallel=T, betaPrior = F)
res.wat <- results(dds.wat, parallel=T)
summary(res.wat)
```

```{r deseq-MA-plot-wat, fig.cap="MA Plot for Effects of Feeding Status on Adipose Tissue"}
plotMA(res.wat, main="Adipose", ylim=c(-4,4))
```

# Session Information

```{r session-info}
sessionInfo()
```
